<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.2">
<title>Trading Stats | Hello Framework</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-near-midnight,alt,wide.b6d83f44.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-near-midnight,alt,wide.b6d83f44.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.9bb31b7c.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.111f9be1.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/e780feca.js">
<link rel="modulepreload" href="./_observablehq/stdlib/duckdb.147b9b82.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.de641f6f.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.17/d761ef9b.js">
<link rel="modulepreload" href="./_npm/@duckdb/duckdb-wasm@1.29.0/daf159fc.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/86074ef6.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/843b6a76.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="./_npm/apache-arrow@21.0.0/8209c79a.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="./_npm/tslib@2.8.1/b62a9c4a.js">
<link rel="modulepreload" href="./_npm/flatbuffers@25.2.10/d14daf6b.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/aa00730b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.9bb31b7c.js";
import {registerFile, FileAttachment} from "./_observablehq/stdlib.111f9be1.js";
import {registerTable} from "./_observablehq/stdlib/duckdb.147b9b82.js";

registerFile("./trade_performance.parquet", {"name":"./trade_performance.parquet","path":"./_file/trade_performance.549f9506.parquet","lastModified":1752171715684,"size":9940});
registerFile("./turbo_data_position.parquet", {"name":"./turbo_data_position.parquet","path":"./_file/turbo_data_position.1b7b8f97.parquet","lastModified":1752171715685,"size":139117});
registerTable("turbo_data_position", FileAttachment("./turbo_data_position.parquet"));
registerTable("trade_performance", FileAttachment("./trade_performance.parquet"));

define({id: "6167dea0", inputs: ["Inputs","Generators"], outputs: ["time_picked_input","time_picked"], body: (Inputs,Generators) => {
// Time picker input for day range selection
const time_picked_input = Inputs.range([1, 365], {step: 1});
const time_picked = Generators.input(time_picked_input);
return {time_picked_input,time_picked};
}});

define({id: "589fb119", mode: "inline", inputs: ["time_picked_input","display"], body: async (time_picked_input,display) => {
display(await(
time_picked_input
))
}});

define({id: "a1f00bc2", inputs: ["sql"], outputs: ["profit_loss_data_full_time"], body: async (sql) => {
const profit_loss_data_full_time = await sql`SELECT strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
       COUNT(*) AS trade_number,
       COUNT(CASE WHEN position_total_performance_percent > 0 THEN 1 END) AS profit_count,
       COUNT(CASE WHEN position_total_performance_percent < 0 THEN 1 END) AS loss_count,
       ROUND(
           100.0 * COUNT(CASE WHEN position_total_performance_percent > 0 THEN 1 END) / COUNT(*),
           2
       ) AS profitable_percentage,
       SUM(position_profit_loss) AS profit_loss_sum
FROM turbo_data_position
WHERE position_status = 'Closed'
GROUP BY day_date
ORDER BY day_date DESC;`;
return {profit_loss_data_full_time};
}});

define({id: "a824cc9a", inputs: ["sql"], outputs: ["cumulative_profit_loss_data_full_time"], body: async (sql) => {
const cumulative_profit_loss_data_full_time = await sql`WITH daily_profit_loss AS (
    SELECT 
        strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
        SUM(position_profit_loss) AS daily_profit_loss_sum
    FROM turbo_data_position
    WHERE position_status = 'Closed'
    GROUP BY day_date
)
SELECT 
    day_date,
    SUM(daily_profit_loss_sum) OVER (ORDER BY day_date) AS cumulative_profit_loss
FROM daily_profit_loss
ORDER BY day_date DESC;`;
return {cumulative_profit_loss_data_full_time};
}});

define({id: "bdcccfc1", inputs: ["sql"], outputs: ["profit_loss_by_year_flat_tax"], body: async (sql) => {
const profit_loss_by_year_flat_tax = await sql`SELECT 
    strftime(execution_time_close, '%Y') AS year,
    SUM(position_profit_loss) AS daily_profit_loss_sum,
    CASE 
        WHEN daily_profit_loss_sum > 0 THEN daily_profit_loss_sum * 0.30
        ELSE 0
    END AS french_flat_tax
FROM turbo_data_position
WHERE position_status = 'Closed'
GROUP BY year`;
return {profit_loss_by_year_flat_tax};
}});

define({id: "6cd6a67c", inputs: ["sql"], outputs: ["streak_data"], body: async (sql) => {
const streak_data = await sql`WITH profitable_days AS (
    SELECT 
        strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
        CASE WHEN SUM(position_profit_loss) > 0 THEN 1 ELSE 0 END AS is_profitable_day
    FROM turbo_data_position
    WHERE position_status = 'Closed'
    GROUP BY day_date
),
streaks AS (
    SELECT
        day_date,
        is_profitable_day,
        ROW_NUMBER() OVER (ORDER BY day_date) - ROW_NUMBER() OVER (PARTITION BY is_profitable_day ORDER BY day_date) AS streak_id
    FROM profitable_days
),
streak_lengths AS (
    SELECT 
        is_profitable_day,
        streak_id,
        COUNT(*) AS streak_length
    FROM streaks
    WHERE is_profitable_day = 1
    GROUP BY is_profitable_day, streak_id
)
SELECT 
    MAX(streak_length) AS best_streak,
    (SELECT COUNT(*)
     FROM streaks
     WHERE is_profitable_day = 1
       AND day_date >= (SELECT MAX(day_date) 
                        FROM streaks 
                        WHERE is_profitable_day = 0)
    ) AS current_streak
FROM streak_lengths;`;
return {streak_data};
}});

define({id: "8d23b2e2", inputs: ["sql"], outputs: ["candle_profit_data"], body: async (sql) => {
const candle_profit_data = await sql`WITH daily_profit_loss AS (
    -- Step 1: Calculate cumulative profit/loss for each trade within a day
    SELECT
        strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
        execution_time_close,
        position_profit_loss,
        SUM(position_profit_loss) OVER (PARTITION BY strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') 
                                        ORDER BY execution_time_close) AS intraday_cumulative_profit_loss
    FROM turbo_data_position
    WHERE position_status = 'Closed'
),
daily_intraday_stats AS (
    -- Step 2: Calculate intraday high and low based on cumulative profit/loss for the day
    SELECT 
        day_date,
        MAX(intraday_cumulative_profit_loss) AS intraday_high,
        MIN(intraday_cumulative_profit_loss) AS intraday_low,
        COUNT(*) AS trade_volume
    FROM daily_profit_loss
    GROUP BY day_date
),
daily_totals AS (
    -- Step 3: Calculate total profit/loss for each day
    SELECT 
        strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
        SUM(position_profit_loss) AS daily_profit_loss_sum
    FROM turbo_data_position
    WHERE position_status = 'Closed'
    GROUP BY day_date
),
cumulative_stats AS (
    -- Step 4: Compute cumulative profit/loss over all days
    SELECT
        day_date,
        SUM(daily_profit_loss_sum) OVER (ORDER BY day_date) AS cumulative_profit_loss
    FROM daily_totals
),
final_stats_with_adjustments AS (
    -- Step 5: Combine stats and adjust High/Low based on cumulative profit/loss
    SELECT 
        d.day_date AS Date,
        COALESCE(LAG(c.cumulative_profit_loss, 1) OVER (ORDER BY d.day_date), 0) AS Open,
        c.cumulative_profit_loss AS Close,
        COALESCE(LAG(c.cumulative_profit_loss, 1) OVER (ORDER BY d.day_date), 0) 
            + i.intraday_high AS High,
        COALESCE(LAG(c.cumulative_profit_loss, 1) OVER (ORDER BY d.day_date), 0) 
            + i.intraday_low AS Low,
        i.trade_volume AS Volume
    FROM daily_intraday_stats i
    JOIN cumulative_stats c ON i.day_date = c.day_date
    JOIN daily_totals d ON i.day_date = d.day_date
)
SELECT * FROM final_stats_with_adjustments
ORDER BY Date;`;
return {candle_profit_data};
}});

define({id: "cc14e825", inputs: ["streak_data"], outputs: ["best_streak","current_streak"], body: (streak_data) => {
const best_streak = streak_data.get(0).best_streak;
const current_streak = streak_data.get(0).current_streak;
return {best_streak,current_streak};
}});

define({id: "1e7e6706", inputs: ["sql","time_picked"], outputs: ["profit_loss_data_time_picked","cumulative_profit_loss_data_time_picked","cumulative_simulated_performance_time_picked"], body: async (sql,time_picked) => {
const profit_loss_data_time_picked = await sql([`WITH recent_trades AS (
    SELECT strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
           position_total_performance_percent,
           position_profit_loss,
           position_status
    FROM turbo_data_position
    WHERE position_status = 'Closed'
)
SELECT day_date,
       COUNT(*) AS trade_number,
       COUNT(CASE WHEN position_total_performance_percent > 0 THEN 1 END) AS profit_count,
       COUNT(CASE WHEN position_total_performance_percent < 0 THEN 1 END) AS loss_count,
       ROUND(
           100.0 * COUNT(CASE WHEN position_total_performance_percent > 0 THEN 1 END) / COUNT(*),
           2
       ) AS profitable_percentage,
       SUM(position_profit_loss) AS profit_loss_sum
FROM recent_trades
WHERE day_date >= (current_date - INTERVAL ${time_picked} DAY)
GROUP BY day_date
ORDER BY day_date DESC;`])

const cumulative_profit_loss_data_time_picked = await sql([`WITH daily_profit_loss AS (
    SELECT 
        strptime(strftime(execution_time_close, '%Y/%m/%d'), '%Y/%m/%d') AS day_date,
        SUM(position_profit_loss) AS daily_profit_loss_sum
    FROM turbo_data_position
    WHERE position_status = 'Closed'
    GROUP BY day_date
)
SELECT 
    day_date,
    SUM(daily_profit_loss_sum) OVER (ORDER BY day_date) AS cumulative_profit_loss
FROM daily_profit_loss
WHERE day_date >= (current_date - INTERVAL ${time_picked} DAY)
ORDER BY day_date DESC;`])

const cumulative_simulated_performance_time_picked = await sql([`WITH daily_multipliers AS (
  SELECT 
    strptime(strftime(date_day, '%Y/%m/%d'), '%Y/%m/%d') AS date_day_format,
    strftime(date_day, '%Y/%m/%d') AS date_day_string,
    perf_day_real,
    (1 + perf_day_real/100) AS daily_multiplier
  FROM trade_performance
  WHERE trade_number_real != 0
    AND date_day >= (current_date - INTERVAL ${time_picked} DAY)
  ORDER BY date_day_format
),
cumulative_performance AS (
  SELECT 
    date_day_format,
    date_day_string,
    perf_day_real,
    daily_multiplier,
    200 * exp(sum(ln(daily_multiplier)) OVER (
      ORDER BY date_day_format
      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    )) AS cumulative_dollar_value
  FROM daily_multipliers
)
SELECT 
  date_day_format,
  date_day_string,
  perf_day_real AS daily_return_percent,
  round(cumulative_dollar_value, 2) AS dollar_value,
  round(((cumulative_dollar_value - 200) / 200 * 100), 2) AS total_percentage_change,
  round((cumulative_dollar_value - 200), 2) AS total_profit_loss
FROM cumulative_performance
ORDER BY date_day_format;`])
return {profit_loss_data_time_picked,cumulative_profit_loss_data_time_picked,cumulative_simulated_performance_time_picked};
}});

define({id: "d8a46ca0", inputs: ["resize","Inputs","profit_loss_by_year_flat_tax","Plot","time_picked","d3","htl","cumulative_profit_loss_data_time_picked","profit_loss_data_time_picked","candle_profit_data"], outputs: ["flat_tax_table","graph_cumulative_profit_loss_bar_chart","graph_profit_loss_bar_chart","candle_profit_loss_over_time"], body: (resize,Inputs,profit_loss_by_year_flat_tax,Plot,time_picked,d3,htl,cumulative_profit_loss_data_time_picked,profit_loss_data_time_picked,candle_profit_data) => {
function flat_tax_table() {
    return resize((width) => 
        Inputs.table(profit_loss_by_year_flat_tax, {
          width,
          columns: [
            "year",
            "french_flat_tax"
          ],
          header: {
            year: "Year",
            french_flat_tax: "Flat Tax (€)"
          }
        })
    );
}

function graph_cumulative_profit_loss_bar_chart() {
    return resize((width) => 
        Plot.plot({
            width,
            height: 250,
            //title: "Cumulative Profit / Loss in € by Day",
            caption: `Displays cumulative profit/loss for the past ${time_picked} days`,
            x: {label: "Date", grid: true, interval: d3.utcDay},
            y: {label: "Cumulative Profit / Loss (€)", grid: true},
            marks: [
                () => htl.svg`<defs>#ff00cc, #3399ff, #00ffd5
                  <linearGradient id="loss_gradient_1" gradientTransform="rotate(90)">
                    <stop offset="0%" stop-color="#ee0979" stop-opacity="1" />
                    <stop offset="55%" stop-color="red" stop-opacity="1" />
                    <stop offset="95%" stop-color="#ff6a00" stop-opacity="1" />
                  </linearGradient>
                  <linearGradient id="profit_gradient_1" gradientTransform="rotate(90)">
                    <stop offset="0%" stop-color="#66ff00" stop-opacity="1" />
                    <stop offset="55%" stop-color="#a8ff78" stop-opacity="1" />
                    <stop offset="95%" stop-color="#93F9B9" stop-opacity="1" />
                  </linearGradient>
                </defs>`,
                Plot.crosshairX(cumulative_profit_loss_data_time_picked, {x: "day_date", y: "cumulative_profit_loss", color: d => d.cumulative_profit_loss >= 0 ? "url(#profit_gradient_1)" : "url(#loss_gradient_1)", opacity: 0.5}),
                Plot.rectY(cumulative_profit_loss_data_time_picked, {
                    x: "day_date",
                    y: "cumulative_profit_loss",
                    r: 2,
                    fill: d => d.cumulative_profit_loss >= 0 ? "url(#profit_gradient_1)" : "url(#loss_gradient_1)",
                    fillOpacity: 0.8,
                    tip: true,
                }),
                Plot.textY(cumulative_profit_loss_data_time_picked, {
                    x: "day_date",
                    y: d => d.cumulative_profit_loss / 2,
                    text: d => `${d.cumulative_profit_loss.toFixed(2)}\n€`,
                    fill: d => d.cumulative_profit_loss >= 0 ? "black" : "white",
                    fontSize: time_picked > 60 ? 0 : 9,
                    textAnchor: "middle"
                })
            ]
        })
    );
}

function graph_profit_loss_bar_chart() {
    return resize((width) => 
        Plot.plot({
            width,
            height: 250,
            title: "Profit / Loss in € by Day",
            caption: `Displays daily profit/loss for the past ${time_picked} days`,
            x: {label: "Date", grid: true, interval: d3.utcDay},
            y: {label: "Profit / Loss (€)", grid: true},
            marks: [
                Plot.crosshairX(profit_loss_data_time_picked, {x: "day_date", y: "profit_loss_sum", color: d => d.profit_loss_sum >= 0 ? "url(#profit_gradient_1)" : "url(#loss_gradient_1)", opacity: 0.5}),
                Plot.rectY(profit_loss_data_time_picked, {
                    x: "day_date",
                    y: "profit_loss_sum",
                    r: 2,
                    fill: d => d.profit_loss_sum >= 0 ? "url(#profit_gradient_1)" : "url(#loss_gradient_1)",
                    fillOpacity: 0.8,
                    tip: true,
                }),
                Plot.textY(profit_loss_data_time_picked, {
                    x: "day_date",
                    y: d => d.profit_loss_sum / 2,
                    text: d => `${d.profit_loss_sum.toFixed(2)}\n€`,
                    fill: d => d.profit_loss_sum >= 0 ? "black" : "white",
                    fontSize: time_picked > 60 ? 0 : 9,
                    textAnchor: "middle"
                })
            ]
        })
    );
}

function candle_profit_loss_over_time() {
    return resize((width) => 
        Plot.plot({
          inset: 6,
          width,
          grid: true,
          title: "Candle ticks of Profit / Loss in € by Day",
          y: {label: "Profit / Loss (€)"},
          color: {domain: [-1, 0, 1], range: ["#ee0979", "currentColor", "#a8ff78"]},
          marks: [
            Plot.crosshairX(candle_profit_data, {x: "Date", y: "Close", opacity: 0.5}),
            Plot.ruleX(candle_profit_data, {
              x: "Date",
              y1: "Low",
              y2: "High"
            }),
            Plot.ruleX(candle_profit_data, {
              x: "Date",
              y1: "Open",
              y2: "Close",
              stroke: (d) => Math.sign(d.Close - d.Open),
              strokeWidth: 4,
              strokeLinecap: "round",
              channels: {Date: "Date", Open: "Open", Close: "Close", Low: "Low", High: "High", Volume: "Volume",},
              tip: {
                  format: {
                    y1: false,
                    y2: false,
                    Date: true,
                    Open: (d) => `${d.toFixed(3)} €`,
                    Close: (d) => `${d.toFixed(3)} €`,
                    High: (d) => `${d.toFixed(3)} €`,
                    Low: (d) => `${d.toFixed(3)} €`,
                    Volume: (d) => `${d.toFixed(0)} Trade(s)`,
                    stroke: true
                  }
              }
            })
          ]
        })
    );
}
return {flat_tax_table,graph_cumulative_profit_loss_bar_chart,graph_profit_loss_bar_chart,candle_profit_loss_over_time};
}});

define({id: "3d5618e6", mode: "inline", inputs: ["d3","profit_loss_data_full_time","display"], body: async (d3,profit_loss_data_full_time,display) => {
display(await(
new Date(d3.min(profit_loss_data_full_time, (d) => d.day_date)).toLocaleDateString()
))
}});

define({id: "efef55c8", mode: "inline", inputs: ["d3","profit_loss_data_full_time","display"], body: async (d3,profit_loss_data_full_time,display) => {
display(await(
new Date(d3.max(profit_loss_data_full_time, (d) => d.day_date)).toLocaleDateString()
))
}});

define({id: "91874d03", mode: "inline", inputs: ["cumulative_profit_loss_data_full_time","display"], body: async (cumulative_profit_loss_data_full_time,display) => {
display(await(
cumulative_profit_loss_data_full_time.slice(0,1).get("").cumulative_profit_loss.toFixed(2) || 0
))
}});

define({id: "cf5c2edd", mode: "inline", inputs: ["current_streak","display"], body: async (current_streak,display) => {
display(await(
current_streak
))
}});

define({id: "6c4d7fa9", mode: "inline", inputs: ["best_streak","display"], body: async (best_streak,display) => {
display(await(
best_streak
))
}});

define({id: "7a31111e", mode: "inline", inputs: ["flat_tax_table","display"], body: async (flat_tax_table,display) => {
display(await(
flat_tax_table()
))
}});

define({id: "31c5e0b2", mode: "inline", inputs: ["graph_cumulative_profit_loss_bar_chart","display"], body: async (graph_cumulative_profit_loss_bar_chart,display) => {
display(await(
graph_cumulative_profit_loss_bar_chart()
))
}});

define({id: "9c64cd8a", mode: "inline", inputs: ["graph_profit_loss_bar_chart","display"], body: async (graph_profit_loss_bar_chart,display) => {
display(await(
graph_profit_loss_bar_chart()
))
}});

define({id: "f74163ff", mode: "inline", inputs: ["candle_profit_loss_over_time","display"], body: async (candle_profit_loss_over_time,display) => {
display(await(
candle_profit_loss_over_time()
))
}});

define({id: "43dde04b", inputs: ["sql"], outputs: ["trade_count_by_action"], body: async (sql) => {
const trade_count_by_action = await sql`SELECT action, COUNT(*) AS trade_count, SUM(position_profit_loss) AS profit_loss_sum
FROM turbo_data_position 
WHERE position_status = 'Closed'
GROUP BY action`;
return {trade_count_by_action};
}});

define({id: "e107c7f4", inputs: ["sql"], outputs: ["day_performance"], body: async (sql) => {
const day_performance = await sql`SELECT strptime(strftime(date_day, '%Y/%m/%d'), '%Y/%m/%d') AS date_day_format,
       strftime(date_day, '%Y/%m/%d') AS date_day_string,
       perf_day_real
FROM trade_performance
WHERE trade_number_real != 0`;
return {day_performance};
}});

define({id: "8debe467", inputs: ["sql"], outputs: ["avg_per_week"], body: async (sql) => {
const avg_per_week = await sql`SELECT week(date_day) AS week_number, avg(perf_day_real) FROM trade_performance GROUP BY week_number ORDER BY week_number DESC`;
return {avg_per_week};
}});

define({id: "359867f0", inputs: ["sql"], outputs: ["avg_52_week"], body: async (sql) => {
const avg_52_week = await sql`SELECT 
    AVG(perf_day_real) AS avg_52_week_performance
FROM 
    trade_performance
WHERE 
    date_day >= (current_date - INTERVAL '52 weeks')`;
return {avg_52_week};
}});

define({id: "f92b11ec", inputs: ["sql"], outputs: ["avg_4_week"], body: async (sql) => {
const avg_4_week = await sql`SELECT 
    AVG(perf_day_real) AS avg_4_week_performance
FROM 
    trade_performance
WHERE 
    date_day >= (current_date - INTERVAL '4 weeks')`;
return {avg_4_week};
}});

define({id: "be1a174f", inputs: ["trade_count_by_action"], outputs: ["tradeCounts"], body: (trade_count_by_action) => {
// Convert Arrow table to a key-value map for easier access
const tradeCounts = Object.fromEntries(
  trade_count_by_action.toArray().map(row => [row.action, row])
);
return {tradeCounts};
}});

define({id: "8a0c2a47", inputs: ["avg_per_week","d3","day_performance","html","avg_4_week","avg_52_week","resize","Plot"], outputs: ["performance_card","formatPercent","trend"], body: (avg_per_week,d3,day_performance,html,avg_4_week,avg_52_week,resize,Plot) => {
function performance_card() {    
    // Access the last and second-to-last week performance
    const lastWeek = avg_per_week.at(0); // The most recent week
    const secondLastWeek = avg_per_week.at(1); // The week before the most recent one

    // Make sure the data exists before calculating
    if (lastWeek && secondLastWeek) {
        const diff1 = lastWeek["avg(perf_day_real)"] - secondLastWeek["avg(perf_day_real)"]; // Compare average performance between weeks
        const range = d3.extent(day_performance.slice(-52), (d) => d["perf_day_real"]); // Range of last 52 weeks


        return html.fragment`
        <h2>Week average performance per day</h2>
        <h1 style="color: ${lastWeek["avg(perf_day_real)"] >= 0 ? "var(--wata-color-profit)" : "var(--wata-color-loss)"}">${formatPercent(lastWeek["avg(perf_day_real)"])}</h1>
        <table>
          <tr>
            <td>1-week change</td>
            <td align="right">${formatPercent(diff1, {signDisplay: "always"})}</td>
            <td>${trend(diff1)}</td>
          </tr>
          <tr>
            <td>4-week average</td>
            <td align="right">${formatPercent(avg_4_week.at(0)["avg_4_week_performance"])}</td>
          </tr>
          <tr>
            <td>52-week average</td>
            <td align="right">${formatPercent(avg_52_week.at(0)["avg_52_week_performance"])}</td>
          </tr>
        </table>
        ${resize((width) =>
          Plot.plot({
            width,
            height: 40,
            axis: null,
            x: {inset: 40},
            marks: [
              Plot.tickX(day_performance.slice(-52), {
                x: "perf_day_real",
                strokeOpacity: 0.5,
                insetTop: 10,
                insetBottom: 10,
                title: (d) => `${d["date_day_string"]}: ${d["perf_day_real"].toFixed(2)}%`,
                tip: {anchor: "bottom"}
              }),
              Plot.text([`${Math.round(range[0])}%`], {frameAnchor: "left"}),
              Plot.text([`${Math.round(range[1])}%`], {frameAnchor: "right"})
            ]
          })
        )}
        <span class="small muted">52-week range</span>
        `;
    } else {
        return html.fragment`<p>Data not available</p>`;
    }
}

function formatPercent(value, format) {
  return value == null
    ? "N/A"
    : (value / 100).toLocaleString("en-US", {minimumFractionDigits: 2, style: "percent", ...format});
}

function trend(v) {
  return v >= 0.005 ? html`<span class="url(#profit_gradient_1)">↗︎</span>`
    : v <= -0.005 ? html`<span class="url(#loss_gradient_1)">↘︎</span>`
    : "→";
}
return {performance_card,formatPercent,trend};
}});

define({id: "65b7a834", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
tradeCounts.long?.trade_count || 0
))
}});

define({id: "03f8fde1", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
(tradeCounts.long?.trade_count || 0) + (tradeCounts.short?.trade_count || 0)
))
}});

define({id: "9b95303f", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
(tradeCounts.long?.profit_loss_sum || 0).toFixed(3)
))
}});

define({id: "13e9458b", mode: "inline", inputs: ["performance_card","display"], body: async (performance_card,display) => {
display(await(
performance_card()
))
}});

define({id: "81460703", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
tradeCounts.short?.trade_count || 0
))
}});

define({id: "03f8fde1-1", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
(tradeCounts.long?.trade_count || 0) + (tradeCounts.short?.trade_count || 0)
))
}});

define({id: "0137ec28", mode: "inline", inputs: ["tradeCounts","display"], body: async (tradeCounts,display) => {
display(await(
(tradeCounts.short?.profit_loss_sum || 0).toFixed(3)
))
}});

define({id: "064e9b81", inputs: ["d3","profit_loss_data_full_time","resize","Plot","day_performance"], outputs: ["winrate_by_day"], body: (d3,profit_loss_data_full_time,resize,Plot,day_performance) => {
function winrate_by_day() {
  const start = d3.utcDay.offset(d3.min(profit_loss_data_full_time, (d) => d.day_date));
  const end = d3.utcDay.offset(d3.max(profit_loss_data_full_time, (d) => d.day_date));
  
  // A helper function to get the start of the month from a date string
  const getMonth = (dateStr) => d3.utcMonth.floor(new Date(dateStr));

  return resize((width) => Plot.plot({
    width,
    height: (d3.utcMonth.count(start, end) + 1) * 62,
    padding: 0,
    title: `Trade Win-rate by Day`,
    caption: "For each cell, Primary value is trade Win-rate by day, The second value is profit made on this day.",
    y: { 
      tickFormat: d3.utcFormat("%b %Y"),
      paddingTop: 3,
      paddingBottom: 3
    },
    color: {
      type: "linear",
      legend: true,
      scheme: "GnBu",
      label: "Trade Win rate (%)"
    },
    marks: [
      // Cell with color and tooltip
      Plot.cell(profit_loss_data_full_time, Plot.group({ fill: "max" }, {
        x: d => new Date(d["day_date"]).getUTCDate(),
        y: d => getMonth(d.day_date),
        fill: d => Math.round(d["profitable_percentage"]),
        fillOpacity: 0.8,
        inset: 1,
        tip: true,
        title: d => `Profitability: ${Math.round(d["profitable_percentage"])}%\nProfitable Trades: ${d["profit_count"]}\nLoss Trades: ${d["loss_count"]}`
      })),
      
      // Text for profitable_percentage
      Plot.text(profit_loss_data_full_time, Plot.group({ text: "max" }, {
        x: d => new Date(d["day_date"]).getUTCDate(),
        y: d => getMonth(d.day_date),
        text: d => `${Math.round(d["profitable_percentage"])}%`,
        fontSize: 13,
        fill: d => (Math.round(d["profitable_percentage"]) <= 70) ? "black" : "white",
        textAnchor: "middle",
        dy: -6
      })),
      
      // Text for perf_day_real
      Plot.text(day_performance, Plot.group({ text: "max" }, {
        x: d => new Date(d["date_day_format"]).getUTCDate(),
        y: d => getMonth(d.date_day_format),
        text: d => `${d["perf_day_real"].toFixed(2)}%`,
        fill: "white",
        textAnchor: "middle",
        fillOpacity: 0.6,
        dy: 8
      }))
    ]
  }));
}
return {winrate_by_day};
}});

define({id: "562ff00d", mode: "inline", inputs: ["winrate_by_day","display"], body: async (winrate_by_day,display) => {
display(await(
winrate_by_day()
))
}});

define({id: "7c029173", inputs: ["sql"], outputs: ["position_duration_data"], body: async (sql) => {
const position_duration_data = await sql`SELECT 
    position_open_price,
    execution_time_open,
    execution_time_close,
    EXTRACT(epoch FROM (execution_time_close - execution_time_open)) / 60 AS open_duration, -- in minutes
    CASE WHEN position_profit_loss > 0 THEN 'Profitable' ELSE 'Non-Profitable' END AS profitability
FROM turbo_data_position
WHERE position_status = 'Closed'`;
return {position_duration_data};
}});

define({id: "889c02fd", inputs: ["resize","Plot","position_duration_data"], outputs: ["graph_position_duration_scatter"], body: (resize,Plot,position_duration_data) => {
// Define the scatter plot with color based on profitability
function graph_position_duration_scatter() {
    return resize((width) => 
        Plot.plot({
            width,
            height: 400,
            //title: "Position Open Price vs. Duration by Profitability",
            x: { label: "Position Open Price (€)", grid: true },
            y: { label: "Duration Open (minutes)", type: "log", grid: true },
            color: { legend: true, scheme: "set1" }, // Using a color scheme for profitability distinction
            marks: [
                Plot.dot(position_duration_data, {
                    x: "position_open_price",
                    y: "open_duration",
                    stroke: "profitability",
                    fill: "profitability",
                    fillOpacity: 0.6,
                    strokeWidth: 1.5,
                    tip: true,
                    r: 5, // radius of the dots for better visibility
                })
            ]
        })
    );
}
return {graph_position_duration_scatter};
}});

define({id: "043d782b", mode: "inline", inputs: ["graph_position_duration_scatter","display"], body: async (graph_position_duration_scatter,display) => {
display(await(
graph_position_duration_scatter()
))
}});

define({id: "0800a465", inputs: ["sql"], outputs: ["trade_profitability_by_price_range_data"], body: async (sql) => {
const trade_profitability_by_price_range_data = await sql`CREATE OR REPLACE TEMP TABLE trade_profitability AS
SELECT
    FLOOR(position_open_price / 2) * 2 AS price_bin_start,
    (COUNT_IF(position_profit_loss > 0) * 100.0 / COUNT(*)) AS profitability_percentage,
    (COUNT_IF(position_profit_loss <= 0) * 100.0 / COUNT(*)) AS loss_percentage,
    COUNT(*) AS total_trades,
FROM turbo_data_position
WHERE position_status = 'Closed'
GROUP BY price_bin_start
ORDER BY price_bin_start;

SELECT
    price_bin_start,
    total_trades,
    CONCAT(price_bin_start, '€ - ', price_bin_start + 2, '€') as price_range,
    ROUND(profitability_percentage, 0) AS profitability_percentage,
    loss_percentage
FROM trade_profitability;`;
return {trade_profitability_by_price_range_data};
}});

define({id: "bd64845e", inputs: ["resize","Plot","htl","trade_profitability_by_price_range_data"], outputs: ["trade_profitability_by_price_range"], body: (resize,Plot,htl,trade_profitability_by_price_range_data) => {
// Function to create a bar chart for trade profitability by price range
function trade_profitability_by_price_range() {
    return resize((width) => 
        Plot.plot({
            width,
          axis: null,
          label: null,
          height: 260,
          marginTop: 20,
          marginBottom: 70,
          //title: "Trade Profitability by Price Range",
          marks: [
            () => htl.svg`<defs>
              <linearGradient id="gradient_3" gradientTransform="rotate(125)">
                <stop offset="1%" stop-color="#fd0" stop-opacity="1" />
                <stop offset="40%" stop-color="#ff3864" stop-opacity="1" />
                <stop offset="90%" stop-color="#6a0dad" stop-opacity="1" />
              </linearGradient>
            </defs>`,
            Plot.axisFx(trade_profitability_by_price_range_data, {fx: "price_bin_start", text: (d) => `${d.total_trades} trades`, frameAnchor: "top", lineAnchor: "top", dy: 2, fill: "url(#gradient_3)", fontSize: 24, fontWeight: "bold", }),
            Plot.waffleY({length: 1}, {y: 100, fillOpacity: 0.4, rx: 3, dy: 20}),
            Plot.waffleY(trade_profitability_by_price_range_data, {fx: "price_bin_start", y: "profitability_percentage", rx: 3, fill: "url(#gradient_3)", fillOpacity: 0.9, dy: 20}),
            Plot.text(trade_profitability_by_price_range_data, {fx: "price_bin_start", text: (d) => `${d.profitability_percentage}% 📈`, frameAnchor: "bottom", lineAnchor: "top", dy: 26, fill: "url(#gradient_3)", fontSize: 24, fontWeight: "bold"}),
            Plot.axisFx(trade_profitability_by_price_range_data, {fx: "price_bin_start", lineWidth: 10, anchor: "bottom", dy: 42, fontSize: 14, fontWeight: "bold", fillOpacity: 0.6, text: (d) => `${d.price_range}`})
          ]
        })
    );
}
return {trade_profitability_by_price_range};
}});

define({id: "ee2ff01a", mode: "inline", inputs: ["trade_profitability_by_price_range","display"], body: async (trade_profitability_by_price_range,display) => {
display(await(
trade_profitability_by_price_range()
))
}});

define({id: "bee25384", inputs: ["d3","profit_loss_data_full_time","resize","Plot","day_performance","time_picked"], outputs: ["performance_by_day","graph_performance_difference_bar_chart"], body: (d3,profit_loss_data_full_time,resize,Plot,day_performance,time_picked) => {
function performance_by_day() {
  const start = d3.utcDay.offset(d3.min(profit_loss_data_full_time, (d) => d.day_date));
  const end = d3.utcDay.offset(d3.max(profit_loss_data_full_time, (d) => d.day_date));

  // Helper function to get the start of the month from a date string.
  // This ensures all days in the same month map to the same y-position.
  const getMonth = (dateStr) => d3.utcMonth.floor(new Date(dateStr));

  return resize((width) => Plot.plot({
    width,
    // The height calculation is already correct and will work with this change.
    height: (d3.utcMonth.count(start, end) + 1) * 62,
    padding: 0,
    title: "Trade Performance by Day", // Added a title for clarity
    caption: "Each cell represents the percentage profit or loss for that day.", // Added a caption
    y: { 
      tickFormat: d3.utcFormat("%b %Y"),
      paddingTop: 3,
      paddingBottom: 3
    },
    color: {
      type: "linear",
      legend: true,
      scheme: "RdYlGn",
      label: "Performance (%)" // Changed label to match content
    },
    marks: [
      // Cell with color and tooltip based on `perf_day_real`
      Plot.cell(day_performance, Plot.group({ fill: "max" }, {
        x: d => new Date(d["date_day_format"]).getUTCDate(),
        y: d => getMonth(d.date_day_format),
        fill: "perf_day_real",
        inset: 1,
        title: d => `Performance: ${d["perf_day_real"].toFixed(2)}%`, // Added % to tooltip
        fillOpacity: 0.8,
      })),
      
      // Text inside each cell showing `perf_day_real` value
      Plot.text(day_performance, Plot.group({ text: "max" }, {
        x: d => new Date(d["date_day_format"]).getUTCDate(),
        // UPDATED: Use the same time mapping for y.
        y: d => getMonth(d.date_day_format),
        text: d => `${d["perf_day_real"].toFixed(2)}%`,
        fontSize: 10,
        fill: "black",
        textAnchor: "middle",
        dy: 0
      }))
    ]
  }));
}


function graph_performance_difference_bar_chart() {
    return resize((width) => 
        Plot.plot({
            width,
            height: 250,
            //title: "Cumulative Profit / Loss in € by Day",
            //caption: `Displays cumulative profit/loss for the past ${time_picked} days`,
            x: {label: "Date", grid: true, interval: d3.utcDay},
            y: {label: "Performance (%)", grid: true},
            marks: [
                Plot.crosshairX(day_performance, {x: "date_day_format", y: "perf_day_real", color: d => d.perf_day_real >= 0 ? "url(#profit_gradient_1)" : "url(#loss_gradient_1)", opacity: 0.5}),
                Plot.rectY(day_performance, {
                    x: "date_day_format",
                    y: "perf_day_real",
                    r: 2,
                    fill: d => d.perf_day_real >= 0 ? "url(#profit_gradient_1)" : "url(#gradient_3)",
                    fillOpacity: 0.8,
                    tip: true,
                }),
                Plot.textY(day_performance, {
                    x: "date_day_format",
                    y: d => d.perf_day_real / 2,
                    text: d => `${d.perf_day_real.toFixed(2)}\n€`,
                    fill: "white",
                    fontSize: time_picked > 0 ? 0 : 9,
                    textAnchor: "middle"
                })
            ]
        })
    );
}
return {performance_by_day,graph_performance_difference_bar_chart};
}});

define({id: "43ceff6a", mode: "inline", inputs: ["performance_by_day","display"], body: async (performance_by_day,display) => {
display(await(
performance_by_day()
))
}});

define({id: "2722a531", mode: "inline", inputs: ["graph_performance_difference_bar_chart","display"], body: async (graph_performance_difference_bar_chart,display) => {
display(await(
graph_performance_difference_bar_chart()
))
}});

define({id: "66fdcdd8", inputs: ["display","Inputs","sql"], outputs: ["turbo_data_position_table"], body: async (display,Inputs,sql) => {
const turbo_data_position_table = ((_) => (display(Inputs.table(_, {select: false})), _))(await sql`SELECT * FROM turbo_data_position WHERE execution_time_open >= DATE '2024-11-04';`);
return {turbo_data_position_table};
}});

</script>
</head>
<body>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div class="tip">
  <h1>📊 Trading Statistics Dashboard</h1>
  <p>Welcome to the WATA public trading analytics! This dashboard provides:</p>
  <ul>
    <li>💰 Current profit/loss tracking</li>
    <li>📈 Trading pattern stats</li>
    <li>🎯 Key performance metrics and insights</li>
  </ul>
  <p><strong>⚠️ Note</strong>, this dashboard:</p>
  <ul>
    <li>⚡ Uses client-side WASM DuckDB for real-time data processing</li>
    <li>🖥️ Is optimized for desktop viewing</li>
  </ul>
</div>
<div class="observablehq observablehq--block"><!--:6167dea0:--></div>
<h2 id="general-filters" tabindex="-1"><a class="observablehq-header-anchor" href="#general-filters">General filters</a></h2>
<div class="grid grid-cols-4">
  <div class="card">
    <h2>Number of days to display</h2>
    <observablehq-loading></observablehq-loading><!--:589fb119:-->
    <span class="small muted"><i>Applied only on certain indicator</i></span>
  </div>
</div>
<hr>
<h1 id="money-stats" tabindex="-1"><a class="observablehq-header-anchor" href="#money-stats">💰/ 💸 Money stats</a></h1>
<div class="observablehq observablehq--block"><!--:a1f00bc2:--></div>
<div class="observablehq observablehq--block"><!--:a824cc9a:--></div>
<div class="observablehq observablehq--block"><!--:bdcccfc1:--></div>
<div class="observablehq observablehq--block"><!--:6cd6a67c:--></div>
<div class="observablehq observablehq--block"><!--:8d23b2e2:--></div>
<div class="observablehq observablehq--block"><!--:cc14e825:--></div>
<div class="observablehq observablehq--block"><!--:1e7e6706:--></div>
<div class="observablehq observablehq--block"><!--:d8a46ca0:--></div>
<div class="grid grid-cols-4">
  <div class="card">
    <h2>Current balance</h2>
    <h3><i><observablehq-loading></observablehq-loading><!--:3d5618e6:--> to <observablehq-loading></observablehq-loading><!--:efef55c8:--></i></h3>
    <span class="big"><observablehq-loading></observablehq-loading><!--:91874d03:--> €</span>
  </div>
  <div class="card">
    <h2>Consecutive Days Without Loss</h2>
        <table>
          <tbody><tr>
            <td align="left">Current</td>
            <td align="right">Best</td>
          </tr>
          <tr>
            <td align="left"><span class="big"><observablehq-loading></observablehq-loading><!--:cf5c2edd:--> days</span></td>
            <td align="right"><span class="big"><observablehq-loading></observablehq-loading><!--:6c4d7fa9:--> days</span></td>
          </tr>
        </tbody></table>
  </div>
  <div class="card">
    <h2>🇫🇷 Flat Tax by year</h2>
    <observablehq-loading></observablehq-loading><!--:7a31111e:-->
  </div>
</div>
<div class="grid grid-cols-2-3" style="grid-auto-rows: auto;">
  <div class="card">
    <h2>Cumulative Profit / Loss in € by Day</h2>
    <observablehq-loading></observablehq-loading><!--:31c5e0b2:--></div>
  <div class="card"><observablehq-loading></observablehq-loading><!--:9c64cd8a:--></div>
  <div class="card"><observablehq-loading></observablehq-loading><!--:f74163ff:--></div>
</div>
<h1 id="trading-and-performance-stats" tabindex="-1"><a class="observablehq-header-anchor" href="#trading-and-performance-stats">Trading &amp; performance stats</a></h1>
<div class="observablehq observablehq--block"><!--:43dde04b:--></div>
<div class="observablehq observablehq--block"><!--:e107c7f4:--></div>
<div class="observablehq observablehq--block"><!--:8debe467:--></div>
<div class="observablehq observablehq--block"><!--:359867f0:--></div>
<div class="observablehq observablehq--block"><!--:f92b11ec:--></div>
<div class="observablehq observablehq--block"><!--:be1a174f:--></div>
<div class="observablehq observablehq--block"><!--:8a0c2a47:--></div>
<div class="grid grid-cols-2">
  <div class="card">
    <h2>Long 📈</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:65b7a834:--></span>
    <span class="muted"> / <observablehq-loading></observablehq-loading><!--:03f8fde1:--></span>
    <br><br>
    <span class="muted">Total Profit / Loss : <observablehq-loading></observablehq-loading><!--:9b95303f:-->€</span>
  </div>
  <div class="card grid-rowspan-2"><observablehq-loading></observablehq-loading><!--:13e9458b:--></div>
  <div class="card">
    <h2>Short 📉</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:81460703:--></span>
    <span class="muted"> / <observablehq-loading></observablehq-loading><!--:03f8fde1-1:--></span>
    <br><br>
    <span class="muted">Total Profit / Loss : <observablehq-loading></observablehq-loading><!--:0137ec28:-->€</span>
  </div>
</div>
<div class="observablehq observablehq--block"><!--:064e9b81:--></div>
<div class="grid grid-cols-2-3" style="margin-top: 2rem;">
  <div class="card"><observablehq-loading></observablehq-loading><!--:562ff00d:--></div>
</div>
<div class="observablehq observablehq--block"><!--:7c029173:--></div>
<div class="observablehq observablehq--block"><!--:889c02fd:--></div>
<div class="grid grid-cols-1">
  <div class="card">
    <h2>Position Open Price vs. Duration by Profitability</h2>
    <span class="small muted"><i>Scatter plot showing position open price vs. open duration, colourl(#loss_gradient_1) by profitability.</i></span>
    <observablehq-loading></observablehq-loading><!--:043d782b:-->
  </div>
</div>
<div class="observablehq observablehq--block"><!--:0800a465:--></div>
<div class="observablehq observablehq--block"><!--:bd64845e:--></div>
<div class="grid grid-cols-1">
  <div class="card">
    <h2>Trade Profitability by Price Range</h2>
    <span class="small muted"><i>Bar chart showing trade profitability percentage by price range.</i></span>
    <observablehq-loading></observablehq-loading><!--:ee2ff01a:-->
  </div>
</div>
<h1 id="day-performance" tabindex="-1"><a class="observablehq-header-anchor" href="#day-performance">Day performance %</a></h1>
<div class="observablehq observablehq--block"><!--:bee25384:--></div>
<div class="grid grid-cols-2-3" style="margin-top: 2rem;">
  <div class="card"><observablehq-loading></observablehq-loading><!--:43ceff6a:--></div>
</div>
<div class="grid grid-cols-2-3" style="margin-top: 2rem;">
  <div class="card"><observablehq-loading></observablehq-loading><!--:2722a531:--></div>
</div>
<hr>
<h1 id="data-table" tabindex="-1"><a class="observablehq-header-anchor" href="#data-table">Data Table</a></h1>
<h2 id="position" tabindex="-1"><a class="observablehq-header-anchor" href="#position">Position</a></h2>
<!-- Display full table from parquet -->
<div class="observablehq observablehq--block"><!--:66fdcdd8:--></div>
<hr>
<!-- Custom styling -->
<style>

:root {
  /* Funky Primary Colors */
  --ifm-color-primary: #6a0dad;
  --ifm-color-primary-dark: #5c0c93;
  --ifm-color-primary-darker: #4c0a7a;
  --ifm-color-primary-darkest: #3c0861;
  --ifm-color-primary-light: #7c0fc8;
  --ifm-color-primary-lighter: #8f14e0;
  --ifm-color-primary-lightest: #a01ff7;

  /* Vibrant Accent Colors */
  --wata-color-profit: #a8ff78;  /* Neon url(#profit_gradient_1) */
  --wata-color-loss: #ee0979;    /* Hot Pink */
  --wata-color-neutral: #c5b4e3; /* Lavender */

  /* Funky Accents */
  --wata-color-accent-1: #ffae00; /* Electric Yellow */
  --wata-color-accent-2: #ff00cc; /* Magenta */
  --wata-color-accent-3: #00eddb; /* Cyan */
  --wata-color-accent-4: #b967ff; /* Purple */

  /* UI Elements */
  --ifm-code-font-size: 95%;
  --docusaurus-highlighted-code-line-bg: rgba(106, 13, 173, 0.1);

  --ifm-navbar-background-color: rgba(0, 0, 0, 0.8);
  --ifm-navbar-background-hover-color: rgba(0, 0, 0, 0.8);
  --ifm-navbar-link-hover-color: var(--wata-color-accent-2);
  
  --ifm-footer-background-color: #120458;
  --ifm-footer-title-color: #ffffff;
  --ifm-footer-link-color: #d1d1d1;

  /* Typography */
  --ifm-font-family-base: 'Archivo', sans-serif;
  --ifm-heading-font-family: 'Poppins', sans-serif;
  --ifm-heading-font-weight: 700;

  /* Card & UI Component Styling */
  --ifm-card-background-color: rgba(255, 255, 255, 0.8);
  --ifm-card-border-radius: 16px;
  --ifm-global-radius: 8px;
  --ifm-global-shadow-md: 0 8px 20px rgba(106, 13, 173, 0.15);

  --ifm-alert-border-radius: 12px;
  --ifm-alert-padding-vertical: 1rem;

  /* Funky Extras */
  --wata-gradient-primary: linear-gradient(45deg, #6a0dad, #ff3864, #fd0);
  --wata-gradient-text: linear-gradient(to right, #ff00cc, #3399ff, #00ffd5);
  --wata-gradient-secondary: linear-gradient(45deg, #ff00cc, #3399ff, #00ffd5);
  --wata-button-shadow: 5px 5px 0px rgba(0,0,0,0.2);
  --wata-skew-angle: -5deg;
  
  /* Set proper z-index values */
  --ifm-z-index-dropdown: 100;
  --ifm-z-index-fixed: 200;
  --ifm-z-index-overlay: 400;
}


.card {
  border: 0.2px solid transparent;
  border-radius: 15px;
  background:
    linear-gradient(var(--ifm-navbar-background-color)) padding-box,
    var(--wata-gradient-primary) border-box;
  transition: all 0.3s;
  filter: drop-shadow(0 0 40px rgba(255, 0, 204, 0.1)) drop-shadow(0 0 40px rgba(255, 234, 0, 0.1));
}

.card:hover {
  border: 4px solid transparent;
  background:
    linear-gradient(var(--ifm-navbar-background-hover-color)) padding-box,
    var(--wata-gradient-secondary) border-box;
      filter: drop-shadow(0 0 40px rgba(255, 0, 204, 0.2)) drop-shadow(0 0 40px rgba(0, 255, 213, 0.2));
}

h1, h2, h3 {
  position: relative;
}

</style></main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-07-10T18:22:01">Jul 10, 2025</a>.</div>
</footer>
</div>
</body>
</html>
